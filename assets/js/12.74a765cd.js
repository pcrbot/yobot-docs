(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{373:function(t,a,s){"use strict";s.r(a);var e=s(26),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"linux-使用-cqhttp-mirai-部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux-使用-cqhttp-mirai-部署"}},[t._v("#")]),t._v(" Linux 使用 cqhttp-mirai 部署")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("阅读此章节前，您需要了解：")]),t._v(" "),s("ul",[s("li",[t._v("Linux 基本用法")]),t._v(" "),s("li",[t._v("screen（或 tmux）")]),t._v(" "),s("li",[t._v("git")])])]),t._v(" "),s("h2",{attrs:{id:"部署过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署过程"}},[t._v("#")]),t._v(" 部署过程")]),t._v(" "),s("h3",{attrs:{id:"环境准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[t._v("#")]),t._v(" 环境准备")]),t._v(" "),s("h4",{attrs:{id:"安装依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖"}},[t._v("#")]),t._v(" 安装依赖")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# RHEL / CentOS:")]),t._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y python3 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("screen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" java-11-openjdk\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Debain / Ubuntu:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y python3 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("screen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" openjdk-11-jre-headless\n")])])]),s("p",[t._v("请确认 python 版本至少为 3.6，如果 "),s("code",[t._v("python3 -V")]),t._v(" 显示版本低于 3.6，请安装新版 python")]),t._v(" "),s("h4",{attrs:{id:"使用终端复用器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用终端复用器"}},[t._v("#")]),t._v(" 使用终端复用器")]),t._v(" "),s("p",[t._v("这里我们用 screen 作为终端复用工具，具体用法请搜索 screen 教程"),s("br"),t._v("\n现在新建一个 screen 终端")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("screen")]),t._v(" -S qqbot\n")])])]),s("h3",{attrs:{id:"部署-yobot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署-yobot"}},[t._v("#")]),t._v(" 部署 yobot")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p ~/qqbot/yobot\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/qqbot/yobot\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载源码")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/pcrbot/yobot.git\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 国内可改用 https://gitee.com/yobot/yobot.git")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" yobot/src/client/\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装依赖")]),t._v("\npip3 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -r requirements.txt --user\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 国内可加上参数 -i https://pypi.tuna.tsinghua.edu.cn/simple")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成 yobotg")]),t._v("\npython3 main.py\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用 yobot")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" yobotg.sh\n")])])]),s("p",[t._v("按下 "),s("code",[t._v("ctrl-a , c")]),t._v(" 连续组合键，新建一个 screen shell")]),t._v(" "),s("h3",{attrs:{id:"部署-mirai"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署-mirai"}},[t._v("#")]),t._v(" 部署 mirai")]),t._v(" "),s("h4",{attrs:{id:"下载-mirai"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载-mirai"}},[t._v("#")]),t._v(" 下载 mirai")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("github_src")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 国内速度较慢可改为下面的镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# github_src="github-proxy.yobot.win"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p ~/qqbot/mirai/plugins/CQHTTPMirai ~/qqbot/mirai/libs\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/qqbot/mirai/libs\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${github_src}")]),t._v("/project-mirai/mirai-repo/raw/master/shadow/mirai-core-qqandroid/mirai-core-qqandroid-1.3.0.jar "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n     https://"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${github_src}")]),t._v("/project-mirai/mirai-repo/raw/master/shadow/mirai-console/mirai-console-1.0-RC-dev-28.jar "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n     https://"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${github_src}")]),t._v("/project-mirai/mirai-repo/raw/master/shadow/mirai-console-terminal/mirai-console-terminal-1.0-RC-dev-28.jar\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/qqbot/mirai/plugins\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${github_src}")]),t._v("/yyuueexxiinngg/cqhttp-mirai/releases/download/0.2.3/cqhttp-mirai-0.2.3-all.jar\n")])])]),s("h4",{attrs:{id:"修改-mirai-配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改-mirai-配置文件"}},[t._v("#")]),t._v(" 修改 Mirai 配置文件")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p ~/qqbot/mirai/config/Console\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" ~/qqbot/mirai/config/Console/AutoLogin.yml\n")])])]),s("p",[t._v("修改配置文件如下（前面是QQ号，后面是密码）")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("plainPasswords")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("123456654321")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" example\n")])])]),s("h4",{attrs:{id:"修改-cqhttpmirai-配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改-cqhttpmirai-配置文件"}},[t._v("#")]),t._v(" 修改 CQHTTPMirai 配置文件")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" ~/qqbot/mirai/plugins/CQHTTPMirai/setting.yml\n")])])]),s("p",[t._v("修改配置文件如下（注意修改 QQ 号）")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 要进行配置的QQ号 (Mirai支持多帐号登录, 故需要对每个帐号进行单独设置)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 详细说明请参考 https://github.com/yyuueexxiinngg/cqhttp-mirai")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果要登录多个账号，或者一个账号连接多个后端，直接按照 yaml 格式增加字段即可")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"1234567890"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ws_reverse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("postMessageFormat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reverseHost")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reversePort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9222")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reversePath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /ws/\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessToken")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里也可以填写事先准备好的 access_token")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reconnectInterval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n")])])]),s("h4",{attrs:{id:"确认配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#确认配置"}},[t._v("#")]),t._v(" 确认配置")]),t._v(" "),s("p",[t._v("通过 tree 命令确认一下目录结构")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/qqbot/mirai\ntree\n")])])]),s("p",[t._v("最终目录结构应该是")]),t._v(" "),s("div",{staticClass:"language-treeview extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("mirai\\\n├── config\\\n│   └── Console\\\n│       └── AutoLogin.yml\\\n├── libs\\\n│   ├── mirai-console-1.0-RC-dev-28.jar\n│   ├── mirai-console-terminal-1.0-RC-dev-28.jar\n│   └── mirai-core-qqandroid-1.3.0.jar\n└── plugins\\\n    ├── CQHTTPMirai\\\n    │   └── setting.yml\n    └── cqhttp-mirai-0.2.3-all.jar\n")])])]),s("h4",{attrs:{id:"启动-mirai"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动-mirai"}},[t._v("#")]),t._v(" 启动 mirai")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/qqbot/mirai\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动命令比较复杂，建议新建一个 start-mirai.sh 将命令填入，方便今后使用")]),t._v("\njava -cp "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./libs/*"')]),t._v(" net.mamoe.mirai.console.terminal.MiraiConsoleTerminalLoader\n")])])]),s("p",[t._v("部署完成，现在可以按下 "),s("code",[t._v("ctrl-a , d")]),t._v(" 连续组合键挂起这两个 shell")]),t._v(" "),s("h2",{attrs:{id:"验证安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证安装"}},[t._v("#")]),t._v(" 验证安装")]),t._v(" "),s("p",[t._v("向机器人发送“version”，机器人会回复当前版本")]),t._v(" "),s("h2",{attrs:{id:"常见问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[t._v("#")]),t._v(" 常见问题")]),t._v(" "),s("p",[t._v("见"),s("RouterLink",{attrs:{to:"/usage/faq.html"}},[t._v("FAQ")])],1),t._v(" "),s("p",[t._v("如果需要多开，请参考"),s("RouterLink",{attrs:{to:"/usage/mirai-multi-instances.html"}},[t._v("mirai多开方法")])],1),t._v(" "),s("h2",{attrs:{id:"开启-web-访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启-web-访问"}},[t._v("#")]),t._v(" 开启 web 访问")]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/usage/web-mode.html"}},[t._v("开启方法")])],1)])}),[],!1,null,null,null);a.default=n.exports}}]);