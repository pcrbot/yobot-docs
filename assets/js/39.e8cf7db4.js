(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{402:function(t,s,a){"use strict";a.r(s);var e=a(27),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"web-模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web-模式"}},[t._v("#")]),t._v(" Web 模式")]),t._v(" "),a("p",[t._v("机器人开启web模式后，可以使用网页版的公会战交互界面。网页版和群聊版互通。")]),t._v(" "),a("h2",{attrs:{id:"开启-web-模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启-web-模式"}},[t._v("#")]),t._v(" 开启 Web 模式")]),t._v(" "),a("p",[t._v("请在服务器上运行软件，"),a("RouterLink",{attrs:{to:"/install/server.html"}},[t._v("服务器推荐")])],1),t._v(" "),a("p",[t._v("如果坚持在本地计算机运行，也可以使用内网穿透（不建议新手使用）")]),t._v(" "),a("h3",{attrs:{id:"方法-1-直接连接-简单原始"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法-1-直接连接-简单原始"}},[t._v("#")]),t._v(" 方法 1：直接连接（简单原始）")]),t._v(" "),a("p",[t._v("直接暴露服务的端口，无法使用加密通信，网址中必须留下端口")]),t._v(" "),a("details",[a("summary",[t._v("（点击展开）")]),t._v(" "),a("p",[t._v("在 yobot "),a("RouterLink",{attrs:{to:"/usage/configuration.html"}},[t._v("配置文件")]),t._v("中，将"),a("code",[t._v("host")]),t._v("字段恢复为"),a("code",[t._v("0.0.0.0")]),t._v("（即默认值，如果没有手动修改过就不用管）")],1),t._v(" "),a("p",[t._v("在服务器的防火墙面板里，打开 9222 端口（如端口更换则为更换后的端口）"),a("br"),t._v("\n（"),a("a",{attrs:{href:"https://help.aliyun.com/document_detail/25471.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("阿里云开启方法"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/213/39740",target:"_blank",rel:"noopener noreferrer"}},[t._v("腾讯云开启方法"),a("OutboundLink")],1),t._v("）\n如果是腾讯云 Windows 服务器，可能还需要放行 Windows 防火墙")]),t._v(" "),a("p",[t._v("由于不同的服务器提供商所需的步骤不同，所以具体方法请通过搜索引擎搜索：【你的提供商+你的操作系统+如何开放端口】")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("如果使用这种方法，"),a("strong",[t._v("必须")]),t._v("为 httpapi 和 yobot 设定 access_token 防止入侵")])])]),t._v(" "),a("h3",{attrs:{id:"方法-2-使用-nginx-代理-麻烦但功能强大-目前的主流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法-2-使用-nginx-代理-麻烦但功能强大-目前的主流"}},[t._v("#")]),t._v(" 方法 2：使用 Nginx 代理（麻烦但功能强大，目前的主流）")]),t._v(" "),a("p",[t._v("如果需要为网页添加日志记录、HTTPS支持、安全限制等，或者需要同时部署其他站点，可以使用 Nginx、Apache 之类的服务器软件")]),t._v(" "),a("p",[t._v("这里只给出实例，不详细讲解方法")]),t._v(" "),a("details",[a("summary",[t._v("（点击展开）")]),t._v(" "),a("p",[t._v("请根据服务器实际情况设定 Nginx 代理，这里给出一个示例，"),a("strong",[t._v("不要直接复制")]),t._v("，如果不懂请用工具生成或请熟悉的人代劳")]),t._v(" "),a("p",[t._v("Nginx 代理配置后，在机器人配置文件中"),a("code",[t._v("public_address")]),t._v("项替换为代理后的地址，安全起见可以将"),a("code",[t._v("host")]),t._v("项设置为"),a("code",[t._v("127.0.0.1")])]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" [::]:80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 使用 https 加密通信，增加安全性（可选）")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# listen 443 ssl http2;")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# listen [::]:443 ssl http2;")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ssl_certificate /home/www/ssl/ssl_certificate.crt;  # 你的证书路径")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ssl_certificate_key /home/www/ssl/ssl_certificate.key;  # 你的私钥路径")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" io.yobot.xyz")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 你的域名")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://127.0.0.1:9222")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 反向代理")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 传递用户IP")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 静态文件直接访问（可选，性能）")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location /yobot/assets/ {")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  alias /home/yobot/src/client/public/static/;  # 你的静态文件目录，如果你修改了`public_basepath`，请同时修改这里的`location`")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  expires 30d;")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 输出文件直接访问（可选，性能）")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location /yobot/output/ {")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  alias /home/yobot/src/client/yobot_data/output/;  # 你的输出文件目录，如果你修改了`public_basepath`，请同时修改这里的`location`")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  charset utf-8;  # 设置 HTTP 响应的字符集避免页面出现乱码")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  expires 30d;")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 阻止 cqhttp 接口被访问(可选，安全)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /ws/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# allow 172.16.0.0/12;  # 允许 cqhttp 通过（yobot与 cqhttp 不在同一个服务器上时使用，ip为 cqhttp 所在服务器的ip）")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("deny")]),t._v(" all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("h3",{attrs:{id:"方法-3-使用-apache-代理-麻烦但功能强大-上个时代的主流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法-3-使用-apache-代理-麻烦但功能强大-上个时代的主流"}},[t._v("#")]),t._v(" 方法 3：使用 Apache 代理（麻烦但功能强大，上个时代的主流）")]),t._v(" "),a("p",[t._v("这里只给出实例，不详细讲解方法")]),t._v(" "),a("details",[a("summary",[t._v("（点击展开）")]),t._v(" "),a("p",[t._v("Apache 支持从任何会被加载的 http-xxxx.conf 读取配置，即使配置本不应属于该文件")]),t._v(" "),a("p",[t._v("所以可以选择一个自己所喜好的，例如将所有的配置信息全部写在 httpd-ssl.conf 里面")]),t._v(" "),a("p",[t._v("在 httpd.conf 内按需启用模块后，在 httpd-ssl.conf 内根据实际情况配置以下内容，"),a("strong",[t._v("如遇到问题请自行配合 error.log 进行故障排除")])]),t._v(" "),a("div",{staticClass:"language-apacheconf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apacheconf"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("Listen")]),t._v(" 443\n\n"),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("SSLProtocol")]),t._v(" all -SSLv3\n"),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("SSLProxyProtocol")]),t._v(" all -SSLv3\n\n"),a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("VirtualHost")]),a("span",{pre:!0,attrs:{class:"token directive-block-parameter attr-value"}},[t._v(" *"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("443")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("ServerName")]),t._v(" io.yobot.xyz\n    "),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("ServerAlias")]),t._v(" io.yobot.xyz\n    "),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("SSLEngine")]),t._v(" on\n    "),a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("IfModule")]),a("span",{pre:!0,attrs:{class:"token directive-block-parameter attr-value"}},[t._v(" remoteip_module")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("RemoteIPHeader")]),t._v(" X-Forwarded-For\n        "),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("RemoteIPInternalProxy")]),t._v(" 127.0.0.1/24\n    "),a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("IfModule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Location")]),a("span",{pre:!0,attrs:{class:"token directive-block-parameter attr-value"}},[t._v(" /")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("ProxyPass")]),t._v(" http://127.0.0.1:9222\n        "),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("ProxyPassReverse")]),t._v(" http://127.0.0.1:9222\n    "),a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("Location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Location")]),a("span",{pre:!0,attrs:{class:"token directive-block-parameter attr-value"}},[t._v(" /cqhttp/ws/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("Deny")]),t._v(" from All\n    "),a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("Location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Location")]),a("span",{pre:!0,attrs:{class:"token directive-block-parameter attr-value"}},[t._v(" /ws/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("Deny")]),t._v(" from All\n    "),a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("Location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token directive-block tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("VirtualHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("SSLCertificateFile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${SRVROOT}")]),t._v('/conf/server.crt"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token directive-inline property"}},[t._v("SSLCertificateKeyFile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${SRVROOT}")]),t._v('/conf/server.key"')]),t._v("\n")])])]),a("p",[t._v("并对 yobot 源码 /src/client/ybplugins/login.py 进行必要的修改")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("userlogin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last_login_ipaddr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-Forwarded-For'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("remote_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last_login_ipaddr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-Forwarded-For'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("remote_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),a("h3",{attrs:{id:"方法-4-使用-caddy-代理-非常简单且强大-比-nginx-稍差"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法-4-使用-caddy-代理-非常简单且强大-比-nginx-稍差"}},[t._v("#")]),t._v(" 方法 4 : 使用 caddy 代理（非常简单且强大，比 nginx 稍差）")]),t._v(" "),a("p",[t._v("这里只给出实例，不详细讲解方法")]),t._v(" "),a("details",[a("summary",[t._v("（点击展开）")]),t._v(" "),a("p",[t._v("下载安装 "),a("code",[t._v("caddy")])]),t._v(" "),a("p",[t._v("创建一个 "),a("code",[t._v("Caddyfile")]),t._v(" （没有扩展名），编写内容如下，其中的 "),a("code",[t._v("example.com")]),t._v(" 替换成你自己的域名。")]),t._v(" "),a("div",{staticClass:"language-caddyfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('example.com {  # 你的域名\n\n  respond /ws/* "Forbidden" 403 {\n    close\n  }\n\n  reverse_proxy * http://127.0.0.1:9222 {\n    header_up +X-Real-IP {remote_host}  # 传递用户IP\n  }\n}\n')])])]),a("p",[t._v("启动 caddy")])]),t._v(" "),a("h2",{attrs:{id:"开始使用-web-模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始使用-web-模式"}},[t._v("#")]),t._v(" 开始使用 Web 模式")]),t._v(" "),a("p",[t._v("向机器人私聊发送“登录”即可")]),t._v(" "),a("p",[t._v("如果需要密码，向机器人私聊发送“重置密码”即可")])])}),[],!1,null,null,null);s.default=n.exports}}]);